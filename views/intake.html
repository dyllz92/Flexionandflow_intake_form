<!DOCTYPE html>
<html lang="en" data-brand="flexion">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Intake Form - Flexion &amp; Flow</title>
    <link rel="stylesheet" href="/css/styles.css?v=20260129-v20">
    <link rel="stylesheet" href="/css/forms.css?v=20260129-v20">
    <script src="/js/brand.js?v=20260127"></script>
</head>
<body data-brand="flexion">
    <div class="container">
        <div class="form-header">
            <img src="/js/Wellcorp_Logo.png?v=20260129" alt="Flexion &amp; Flow Logo" class="logo-small">
            <h1 id="formTitle">Client Intake Form</h1>
        </div>

        <!-- Step Indicator -->
        <div id="stepIndicator" class="step-indicator">
            <div class="step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Details</span>
            </div>
            <div class="step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Today's Focus</span>
            </div>
            <div class="step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Health Check</span>
            </div>
            <div class="step" data-step="4">
                <span class="step-number">4</span>
                <span class="step-label">Consent & Sign</span>
            </div>
        </div>

        <form id="intakeForm" class="intake-form wizard-form">
            <!-- Hidden field for selected brand -->
            <input type="hidden" id="selectedBrand" name="selectedBrand" value="flexion">

            <!-- Step 1: Details -->
            <div class="wizard-step form-section" data-step="1">
                <h2>Step 1 — Details</h2>

                <div class="form-group">
                    <label>Gender (optional):</label>
                    <div class="radio-group inline">
                        <label><input type="radio" name="gender" value="Male"> Male</label>
                        <label><input type="radio" name="gender" value="Female"> Female</label>
                        <label><input type="radio" name="gender" value="Prefer not to disclose"> Prefer not to disclose</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fullName">Full Name: <span class="required">*</span></label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>

                <div class="form-group">
                    <label for="dateOfBirth">Date of Birth: <span class="required">*</span></label>
                    <input type="date" id="dateOfBirth" name="dateOfBirth" required style="width:100%; padding:12px; border:1px solid var(--border-color); border-radius:12px; font-size:16px; background:var(--input-bg);">
                </div>

                <div class="form-group">
                    <label for="mobile">Phone Number: <span class="required">*</span></label>
                    <input type="tel" id="mobile" name="mobile" placeholder="e.g., 0412 345 678" required>
                    <div class="form-error" id="error-mobile"></div>
                </div>

                <div class="form-group">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="email">
                </div>

                <div class="form-group">
                    <label for="occupation">Occupation: <span class="required">*</span></label>
                    <input type="text" id="occupation" name="occupation" placeholder="e.g., Office Worker, Athlete, Student" maxlength="100" required>
                </div>

                <div class="form-group">
                    <label for="feelingPre" id="feelingPreLabel">How are we feeling right now (pre-massage)? <span class="required">*</span></label>
                    <div style="display:flex; align-items:flex-start; gap:12px; margin-top:8px; position:relative;">
                        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; min-width:50px;">
                            <span style="font-size:12px; font-weight:600; color:var(--text-light);">1</span>
                            <span style="font-size:11px; color:var(--text-light); text-align:center;">Not Great</span>
                        </div>
                        <input type="range" id="feelingPre" name="feelingPre" min="1" max="10" value="5" style="flex:1; cursor:pointer; margin-top:6px;" aria-labelledby="feelingPreLabel" aria-valuemin="1" aria-valuemax="10" aria-valuenow="5" aria-valuetext="5 out of 10">
                        <div style="display:flex; flex-direction:column; align-items:center; gap:4px; min-width:50px;">
                            <span style="font-size:12px; font-weight:600; color:var(--text-light);">10</span>
                            <span style="font-size:11px; color:var(--text-light); text-align:center;">Fantastic</span>
                        </div>
                        <span id="feelingPreValue" style="min-width:36px; padding:6px 10px; background:var(--primary-color); color:white; border-radius:6px; font-weight:600; text-align:center; margin-top:6px;" aria-hidden="true">5</span>
                    </div>
                </div>

                <div style="margin-top:24px; padding-top:16px; border-top:1px solid var(--border-color); text-align:center;">
                    <p style="font-size:13px; color:var(--text-light); margin:0;">All details filled in? Click <strong>Next</strong> to continue.</p>
                </div>
            </div>

            <!-- Step 2: Today's Focus -->
            <div class="wizard-step form-section" data-step="2">
                <h2>Step 2 — Today's Focus</h2>
                <p class="section-note">Tap the body map to mark areas of discomfort. Tap a dot to remove it.</p>
                <div class="muscle-map-container">
                    <div id="muscleMapContainer"></div>
                    <div style="display: flex; gap: 12px; margin-top: 12px;">
                        <button type="button" id="expandBodyMap" class="btn-secondary" style="flex: 1;">Expand Body Map</button>
                        <button type="button" id="clearMuscleMap" class="btn-secondary" style="flex: 1;">Clear</button>
                    </div>
                    <input type="hidden" id="muscleMapMarks" name="muscleMapMarks" value="[]">
                </div>

                <div class="form-group">
                    <label>Pressure Preference: <span class="required">*</span></label>
                    <div class="radio-group inline">
                        <label><input type="radio" name="pressurePreference" value="Light"> Light</label>
                        <label><input type="radio" name="pressurePreference" value="Medium"> Medium</label>
                        <label><input type="radio" name="pressurePreference" value="Firm"> Firm</label>
                    </div>
                    <p style="font-size: 12px; color: var(--text-light); margin-top: 8px; font-style: italic;">Continue scrolling for more options →</p>
                </div>

                <!-- Table-only: Oil/Skin Contact -->
                <div id="tableOilSection" class="form-group hidden-field">
                    <label>Oil / Skin Contact: <span class="required">*</span></label>
                    <div class="radio-group">
                        <label><input type="radio" name="tableOilPreference" id="tableOilOk" value="ok" checked> Oil/skin contact OK</label>
                        <label><input type="radio" name="tableOilPreference" value="noOil"> Prefer no oil</label>
                        <label><input type="radio" name="tableOilPreference" value="sensitive"> Sensitive/allergic</label>
                    </div>
                    <div id="tableOilAllergySection" class="form-group hidden-field" style="margin-top:12px;">
                        <label for="tableOilAllergyDetails">Allergy/sensitivity details: <span class="required">*</span></label>
                        <textarea id="tableOilAllergyDetails" name="tableOilAllergyDetails" rows="2" maxlength="200" placeholder="Eg nut oils, fragrances, latex, eczema flare-ups"></textarea>
                        <div class="form-error" id="error-tableOilAllergyDetails"></div>
                    </div>
                </div>

                <!-- Table-only: Position Comfort -->
                <div id="tablePositionSection" class="form-group hidden-field">
                    <label>Position Comfort: <span class="required">*</span></label>
                    <div class="radio-group">
                        <label><input type="radio" name="tablePositionComfort" id="tablePositionOk" value="ok" checked> Fine face down and face up</label>
                        <label><input type="radio" name="tablePositionComfort" value="trouble"> Trouble with one position</label>
                    </div>
                    <div id="tablePositionDetailsSection" class="form-group hidden-field" style="margin-top:12px;">
                        <label for="tablePositionDetails">Position details: <span class="required">*</span></label>
                        <textarea id="tablePositionDetails" name="tablePositionDetails" rows="2" maxlength="200" placeholder="Which position and why? Eg pregnancy, reflux, vertigo, neck/back pain, breathing issues"></textarea>
                        <div class="form-error" id="error-tablePositionDetails"></div>
                    </div>
                </div>

                <div style="margin-top:24px; padding-top:16px; border-top:1px solid var(--border-color); text-align:center;">
                    <p style="font-size:13px; color:var(--text-light); margin:0;">Selected your focus areas? Click <strong>Next</strong> to continue.</p>
                </div>
            </div>

            <!-- Step 3: Quick Health Check -->
            <div class="wizard-step form-section" data-step="3">
                <h2>Step 3 — Quick Health Check</h2>
                <p class="section-note">Let's check in on your wellbeing</p>

                <!-- Button for "I feel well" -->
                <div style="margin-bottom: 28px;">
                    <label style="display: block; width: 100%;">
                        <input type="radio" name="healthStatus" value="well" checked style="display: none;" id="feelWellRadio">
                        <button type="button" id="feelWellToggle" class="btn btn-secondary" style="width: 100%; padding: 14px; cursor: pointer;">
                            ✓ I feel well today / No issues to report
                        </button>
                    </label>
                </div>

                <!-- Detailed health checks -->
                <div id="detailedHealthChecks" style="margin-top: 20px;">
                    <p style="font-size: 14px; color: var(--text-light); margin-bottom: 20px;">Please let us know if any of the following apply to you. Discuss these with your therapist.</p>

                    <!-- Recent Events Category -->
                    <div class="health-category expandable" data-category="recent">
                        <h3 class="category-title category-toggle">▼ Recent Events</h3>
                        <div class="category-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="healthChecks" value="Pregnant"> Pregnant</label>
                                <label><input type="checkbox" name="healthChecks" value="Recent surgery (last 6 months)"> Recent surgery (last 6 months)</label>
                                <label><input type="checkbox" name="healthChecks" value="Recent injury (last 3 months)"> Recent injury (last 3 months)</label>
                            </div>
                        </div>
                    </div>

                    <!-- Cardiovascular Category -->
                    <div class="health-category expandable" data-category="cardio">
                        <h3 class="category-title category-toggle">▼ Heart & Circulation</h3>
                        <div class="category-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="healthChecks" value="Heart condition"> Heart condition</label>
                                <label><input type="checkbox" name="healthChecks" value="Pacemaker/implanted device"> Pacemaker/implanted device</label>
                                <label><input type="checkbox" name="healthChecks" value="History of blood clots / DVT"> History of blood clots / DVT</label>
                                <label><input type="checkbox" name="healthChecks" value="On blood thinners"> On blood thinners</label>
                                <label><input type="checkbox" name="healthChecks" value="High blood pressure (uncontrolled)"> High blood pressure (uncontrolled)</label>
                            </div>
                        </div>
                    </div>

                    <!-- Skin & Infection Category -->
                    <div class="health-category expandable" data-category="skin">
                        <h3 class="category-title category-toggle">▼ Skin & Infection</h3>
                        <div class="category-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="healthChecks" value="Skin infection/rash/open wound in areas to be treated"> Skin infection/rash/open wound in areas to be treated</label>
                                <label><input type="checkbox" name="healthChecks" value="Fever / contagious illness today"> Fever / contagious illness today</label>
                                <label><input type="checkbox" name="healthChecks" value="Allergies/sensitivities (balms/oils/fragrances)"> Allergies/sensitivities (balms/oils/fragrances)</label>
                            </div>
                        </div>
                    </div>

                    <!-- Neurological Category -->
                    <div class="health-category expandable" data-category="neuro">
                        <h3 class="category-title category-toggle">▼ Neurological</h3>
                        <div class="category-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="healthChecks" value="Numbness/tingling (unexplained)"> Numbness/tingling (unexplained)</label>
                                <label><input type="checkbox" name="healthChecks" value="Dizziness/fainting episodes"> Dizziness/fainting episodes</label>
                            </div>
                        </div>
                    </div>

                    <!-- Other Category -->
                    <div class="health-category expandable" data-category="other">
                        <h3 class="category-title category-toggle">▼ Other</h3>
                        <div class="category-content">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="healthChecks" value="Diabetes"> Diabetes</label>
                                <label><input type="checkbox" name="healthChecks" value="Other health concern"> Other health concern: <input type="text" name="otherHealthConcernText" id="otherHealthConcernText" maxlength="200"></label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="healthBanner" class="info-box hidden-field" style="background:rgba(30,136,199,0.06); border:2px solid var(--accent-color); margin-top:20px;">
                    <p><strong>Please provide more details:</strong></p>
                    <div class="form-group" style="margin-top:10px;">
                        <label for="reviewNote">Additional information: <span class="required">*</span></label>
                        <p style="font-size: 13px; color: var(--text-light); margin: 4px 0 8px 0; font-style: italic;">
                            Please include dates (or how long ago), how long it has been going on, what happened, any diagnosis, and anything else relevant. Enter <strong>N/A</strong> if additional information is not required.
                        </p>
                        <textarea id="reviewNote" name="reviewNote" rows="3" maxlength="500" placeholder="e.g., Lower back pain started 3 weeks ago after lifting, intermittent sharp pain, no diagnosis yet"></textarea>
                        <div class="form-error" id="error-reviewNote"></div>
                    </div>
                </div>

                <div style="margin-top:24px; padding-top:16px; border-top:1px solid var(--border-color); text-align:center;">
                    <p style="font-size:13px; color:var(--text-light); margin:0;">Health check complete? Click <strong>Next</strong> to continue.</p>
                </div>
            </div>

            <!-- Step 4: Consent & Signature -->
            <div class="wizard-step form-section consent-section" data-step="4" style="border:2px solid var(--accent-color); padding:20px; border-radius:12px;">
                <h2>Step 4 — Consent & Signature</h2>

                <div class="info-box">
                    <p><strong>Notes:</strong></p>
                    <ul>
                        <li>Delivered fully clothed, no oils used.</li>
                        <li>Pressure is adjustable — tell us if you'd like less or more.</li>
                        <li>This is not a substitute for medical treatment.</li>
                        <li>You can stop the session at any time.</li>
                    </ul>
                </div>

                <div style="margin-bottom:12px;">
                    <button type="button" id="viewTermsBtn" class="btn-secondary" style="width:100%;" aria-label="View Declaration and Privacy Consent">View Declaration & Privacy Consent</button>
                </div>

                <div class="consent-checkbox">
                    <label>
                        <input type="checkbox" name="consentAll" id="consentAll" required>
                        <span id="consentText">I confirm that I have read, understood, and agree to the above terms. This tick serves as my digital signature and consent to the collection, storage, and use of my personal information for the stated purposes. <span class="required">*</span></span>
                    </label>
                </div>

                <div class="consent-checkbox">
                    <label>
                        <input type="checkbox" name="emailOptIn" id="emailOptIn"> Receive occasional email updates
                    </label>
                </div>

                <div class="signature-area">
                    <h2>Signature <span class="optional">(optional)</span></h2>
                    <p class="section-note">Draw your signature below using your finger or mouse.</p>

                    <div class="signature-draw">
                        <div class="signature-container">
                            <div class="signature-pad-frame">
                                <canvas id="signatureCanvas" class="signature-pad"></canvas>
                            </div>
                            <button type="button" id="clearSignature" class="btn-secondary">Clear Signature</button>
                        </div>
                    </div>

                    <input type="hidden" id="signatureData" name="signature">
                    <input type="hidden" id="signedAt" name="signedAt">
                </div>

                <div style="margin-top:24px; padding-top:16px; border-top:1px solid var(--border-color); text-align:center;">
                    <p style="font-size:13px; color:var(--text-light); margin:0;">Everything complete? Click <strong>Submit Intake</strong> to finish.</p>
                </div>
            </div>

            <!-- Sticky Action Bar (wizard controls) -->
            <div class="form-actions sticky-actions wizard-bottom-bar" style="align-items:center;">
                <button type="button" id="prevBtn" class="btn-secondary">Back</button>
                <button type="button" id="nextBtn" class="btn-primary">Next</button>
                <button type="submit" id="submitBtn" class="btn-primary" style="display:none;">Submit Intake</button>
            </div>
        </form>
    </div>

    <script src="/js/auPhoneFormatter.js?v=20260127" defer></script>
    <script src="/js/signature.js?v=20260125" defer></script>
    <script src="/js/muscleMap.js?v=20260125" defer></script>
    <script src="/js/conditionalFields.js?v=20260125" defer></script>
    <script src="/js/healthDisclaimers.js?v=20260129" defer></script>
    <script src="/js/wizard.js?v=20260125" defer></script>
    
    <!-- Terms + Privacy Modal -->
    <div id="termsModal" class="terms-modal hidden-field" role="dialog" aria-modal="true" aria-labelledby="termsModalTitle">
        <div class="terms-backdrop"></div>
        <div class="terms-content" role="document">
            <div class="terms-header">
                <h2 id="termsModalTitle">Declaration & Privacy Consent</h2>
                <button type="button" id="closeTermsBtn" class="btn-secondary" aria-label="Close">Close</button>
            </div>
            <div class="terms-body">
                <div style="white-space:pre-wrap; line-height:1.6;">I confirm that the information I have provided in this form is true and complete to the best of my knowledge. I understand that it is my responsibility to inform the practitioner of any changes to my health or medical history that may affect my treatment.

I acknowledge that my personal and health information is collected for the purpose of delivering safe and effective massage therapy. This information will be stored securely within Flexion & Flow's authorised systems, including Google Workspace and Carepatron, in accordance with the Privacy Act 1988 (Cth) and the Australian Privacy Principles.

My information will remain confidential and will not be disclosed to any third party without my consent, except where disclosure is required or authorised by law. I understand that I may request access to, or correction of, my records at any time by contacting Dylan Ennis, Owner of Flexion & Flow.</div>
            </div>
        </div>
    </div>

    <!-- Body Map Expand Modal -->
    <div id="bodyMapModal" class="body-map-modal hidden-field" role="dialog" aria-modal="true" aria-labelledby="bodyMapModalTitle">
        <div class="body-map-backdrop"></div>
        <div class="body-map-content" role="document">
            <div class="body-map-header">
                <h2 id="bodyMapModalTitle">Body Map - Tap to mark areas of discomfort</h2>
                <button type="button" id="closeBodyMapBtn" class="btn-secondary" aria-label="Close Body Map">Close</button>
            </div>
            <div class="body-map-body">
                <div id="muscleMapContainerExpanded"></div>
                <div class="body-map-controls">
                    <button type="button" id="zoomInBtn" class="btn-secondary">Zoom In (+)</button>
                    <button type="button" id="zoomOutBtn" class="btn-secondary">Zoom Out (-)</button>
                    <button type="button" id="resetZoomBtn" class="btn-secondary">Reset View</button>
                    <button type="button" id="clearMuscleMapExpanded" class="btn-secondary">Clear All</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/termsModal.js?v=20260125" defer></script>
    <script src="/js/bodyMapModal.js?v=20260126" defer></script>
    <script src="/js/form-utils.js?v=20260128" defer></script>
    <script src="/js/intake-form.js?v=20260128" defer></script>

    <script>
        // Initialize form type on intake form (Flexion & Flow)
        document.addEventListener('DOMContentLoaded', () => {
            // Get form type from URL parameter or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            let formType = urlParams.get('form') || getSelectedFormType() || 'seated';

            // Feeling slider value display with accessibility
            const feelingSlider = document.getElementById('feelingPre');
            const feelingValue = document.getElementById('feelingPreValue');
            if (feelingSlider && feelingValue) {
                feelingSlider.addEventListener('input', () => {
                    feelingValue.textContent = feelingSlider.value;
                    // Update ARIA attributes for screen readers
                    feelingSlider.setAttribute('aria-valuenow', feelingSlider.value);
                    feelingSlider.setAttribute('aria-valuetext', feelingSlider.value + ' out of 10');
                });
            }

            // Store form type in localStorage
            setSelectedFormType(formType);

            // Set hidden field value
            const formTypeInput = document.getElementById('formType');
            if (formTypeInput) {
                formTypeInput.value = formType;
            }

            // Update form title based on form type
            const formTitle = document.getElementById('formTitle');
            const formTypeDisplay = getFormTypeDisplayName(formType);

            document.title = formTypeDisplay + ' - Flexion & Flow';
            if (formTitle) {
                const titleText = formType === 'table' ? 'Table Massage Intake' : 'Seated Chair Massage Intake';
                formTitle.innerHTML = titleText;
            }

            // Consent text is now the same for all form types (Declaration & Privacy Consent)
            // No need to update dynamically based on form type

            // Show/hide table-specific fields based on form type
            initTableFieldVisibility(formType);
        });

        /**
         * Initialize table field visibility based on form type
         * @param {string} formType - 'seated' or 'table'
         */
        function initTableFieldVisibility(formType) {
            const tableOilSection = document.getElementById('tableOilSection');
            const tablePositionSection = document.getElementById('tablePositionSection');

            if (formType === 'table') {
                // Show table fields
                if (tableOilSection) tableOilSection.classList.remove('hidden-field');
                if (tablePositionSection) tablePositionSection.classList.remove('hidden-field');
            } else {
                // Hide table fields
                if (tableOilSection) tableOilSection.classList.add('hidden-field');
                if (tablePositionSection) tablePositionSection.classList.add('hidden-field');

                // Clear table field values and remove them from form submission
                clearTableFieldValues();
            }
        }

        /**
         * Clear all table-specific field values
         */
        function clearTableFieldValues() {
            const tableFields = [
                'tableOilPreference',
                'tableOilAllergyDetails',
                'tablePositionComfort',
                'tablePositionDetails'
            ];

            tableFields.forEach(fieldId => {
                const field = document.querySelector('[name="' + fieldId + '"]');
                if (field) {
                    if (field.type === 'radio') {
                        field.checked = false;
                    } else if (field.type === 'text' || field.tagName === 'TEXTAREA') {
                        field.value = '';
                    }
                }
            });
        }
    </script>
</body>
</html>

